<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Book Manager CRUD</title>
<style>
body { font-family: sans-serif; padding: 20px; background: #f6f8fa; }
h1 { color: #333; }
input, button { padding: 8px; margin: 5px; }
table { border-collapse: collapse; width: 100%; background: white; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
tr:hover { background-color: #f1f1f1; }
button { cursor: pointer; }
.pagination {
    margin: 20px 0;
    display: flex;
    justify-content: center;
    gap: 10px;
}
.pagination button {
    padding: 5px 10px;
    border: 1px solid #ddd;
    background: white;
}
.pagination button.active {
    background: #007bff;
    color: white;
    border-color: #007bff;
}
.search-container {
    margin: 20px 0;
    display: flex;
    gap: 10px;
}
.page-size-selector {
    margin: 20px 0;
}
</style>
</head>
<body>

<h1>ðŸ“š Book Manager CRUD (Fetch API + Spring Boot)</h1>

<h3>Add New Book</h3>
<input type="text" id="title" placeholder="Title">
<input type="text" id="author" placeholder="Author">
<button onclick="addBook()">Add Book</button>

<div class="search-container">
    <input type="text" id="searchInput" placeholder="Search by title...">
    <button onclick="searchBooks()">Search</button>
</div>

<div class="page-size-selector">
    Show items per page: 
    <select id="pageSize" onchange="changePageSize()">
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="15">15</option>
    </select>
</div>

<h3>Book List</h3>
<table id="bookTable">
    <thead>
        <tr><th>ID</th><th>Title</th><th>Author</th><th>Actions</th></tr>
    </thead>
    <tbody></tbody>
</table>

<div class="pagination" id="pagination"></div>

<script>
// API Base URL
const API_URL = 'http://localhost:8080/api/books';

// Global variables for pagination
let currentPage = 0;
let pageSize = 5;
let totalPages = 0;
let searchQuery = '';

// Fetch all books and display
function fetchBooks() {
    const url = new URL(API_URL);
    url.searchParams.append('page', currentPage);
    url.searchParams.append('size', pageSize);
    if (searchQuery) {
        url.searchParams.append('title', searchQuery);
    }

    fetch(url)
        .then(res => res.json())
        .then(data => {
            const tbody = document.querySelector('#bookTable tbody');
            tbody.innerHTML = '';
            totalPages = data.totalPages;
            
            data.content.forEach(book => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${book.id}</td>
                    <td><input value="${book.title}" id="title-${book.id}"></td>
                    <td><input value="${book.author}" id="author-${book.id}"></td>
                    <td>
                        <button onclick="updateBook(${book.id})">Update</button>
                        <button onclick="deleteBook(${book.id})">Delete</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            updatePagination();
        })
        .catch(err => console.error(err));
}

function updatePagination() {
    const pagination = document.getElementById('pagination');
    pagination.innerHTML = '';
    
    // Previous button
    const prevButton = document.createElement('button');
    prevButton.innerText = 'Previous';
    prevButton.disabled = currentPage === 0;
    prevButton.onclick = () => goToPage(currentPage - 1);
    pagination.appendChild(prevButton);
    
    // Page numbers
    for (let i = 0; i < totalPages; i++) {
        const pageButton = document.createElement('button');
        pageButton.innerText = i + 1;
        pageButton.classList.toggle('active', i === currentPage);
        pageButton.onclick = () => goToPage(i);
        pagination.appendChild(pageButton);
    }
    
    // Next button
    const nextButton = document.createElement('button');
    nextButton.innerText = 'Next';
    nextButton.disabled = currentPage === totalPages - 1;
    nextButton.onclick = () => goToPage(currentPage + 1);
    pagination.appendChild(nextButton);
}

function goToPage(page) {
    currentPage = page;
    fetchBooks();
}

function searchBooks() {
    searchQuery = document.getElementById('searchInput').value.trim();
    currentPage = 0;
    fetchBooks();
}

function changePageSize() {
    pageSize = parseInt(document.getElementById('pageSize').value);
    currentPage = 0;
    fetchBooks();
}

// Add a new book
function addBook() {
    const title = document.getElementById('title').value.trim();
    const author = document.getElementById('author').value.trim();
    if (!title || !author) {
        alert('Please enter title and author');
        return;
    }
    fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, author })
    })
    .then(() => {
        document.getElementById('title').value = '';
        document.getElementById('author').value = '';
        fetchBooks();
    })
    .catch(err => console.error(err));
}

// Update book
function updateBook(id) {
    const title = document.getElementById(`title-${id}`).value.trim();
    const author = document.getElementById(`author-${id}`).value.trim();
    fetch(`${API_URL}/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, author })
    })
    .then(() => fetchBooks())
    .catch(err => console.error(err));
}

// Delete book
function deleteBook(id) {
    if (!confirm('Are you sure you want to delete this book?')) return;
    fetch(`${API_URL}/${id}`, { method: 'DELETE' })
        .then(() => fetchBooks())
        .catch(err => console.error(err));
}

// Initialize
fetchBooks();
</script>

</body>
</html>
